<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SemitONada</title>
<style>
  :root {
    --cor-fundo: #121212;
    --cor-texto: #eee;
    --cor-primaria: #0ff;
    --cor-secundaria: #088;
    --cor-alerta: #0f0;
    --espacamento: 1rem;
    --fonte: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background-color: var(--cor-fundo);
    color: var(--cor-texto);
    font-family: var(--fonte);
    padding: var(--espacamento);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .container {
    max-width: 800px;
    margin: auto;
  }
  h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    font-weight: 700;
    letter-spacing: 2px;
  }
  .controles {
    display: flex;
    flex-wrap: wrap;
    gap: var(--espacamento);
    justify-content: center;
    margin-bottom: 1rem;
  }
  .tom-btns {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .tom-btns label {
    font-weight: 600;
  }
  .tom-btns button,
  .modo-toggle button {
    background: var(--cor-secundaria);
    border: none;
    color: var(--cor-texto);
    padding: 0.5rem 1rem;
    margin: 0 0.25rem;
    cursor: pointer;
    border-radius: 4px;
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
    min-width: 38px;
    text-align: center;
  }
  .tom-btns button.ativo,
  .modo-toggle button.ativo,
  .tom-btns button:hover,
  .modo-toggle button:hover {
    background: var(--cor-primaria);
  }
  .graus {
    display: flex;
    justify-content: space-around;
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    user-select: none;
  }
  .graus div {
    flex: 1;
    text-align: center;
  }
  .acordes {
    display: flex;
    justify-content: space-around;
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    user-select: none;
  }
  .acordes div {
    flex: 1;
    text-align: center;
    cursor: pointer;
    border-radius: 6px;
    padding: 0.4rem;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .acordes div[data-fechado="true"] {
    background-color: var(--cor-secundaria);
    color: #444;
    cursor: pointer;
  }
  .acordes div:hover:not([data-fechado="true"]) {
    background-color: var(--cor-primaria);
    color: var(--cor-fundo);
  }
  .meta {
    text-align: center;
    font-style: italic;
    margin-bottom: 1rem;
    min-height: 1.5rem;
  }
  .teoria {
    background-color: #222;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    color: var(--cor-texto);
    line-height: 1.5;
  }
  .tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  .tabs button {
    flex: 1;
    background: var(--cor-secundaria);
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    border-radius: 4px;
    color: var(--cor-texto);
    font-weight: 600;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .tabs button.ativo,
  .tabs button:hover {
    background: var(--cor-primaria);
  }
  .aba {
    display: none;
    color: var(--cor-texto);
  }
  .aba[style*="display: block"] {
    display: block;
  }
  #btnPix {
    background: var(--cor-primaria);
    color: var(--cor-fundo);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #btnPix:hover {
    background: var(--cor-secundaria);
  }
  #confirmacaoPix {
    font-weight: 700;
    text-align: center;
  }
  @media (max-width: 600px) {
    .controles {
      flex-direction: column;
      align-items: center;
    }
    .tom-btns button,
    .modo-toggle button {
      margin: 0.25rem 0;
    }
    .graus,
    .acordes {
      flex-direction: column;
    }
    .graus div,
    .acordes div {
      margin-bottom: 0.5rem;
    }
  }
</style>
</head>
<body>
<main class="container">
  <h1>SemitONada</h1>

  <section class="controles" aria-label="Controles do Campo Harm√¥nico">
    <div class="tom-btns" role="group" aria-label="Sele√ß√£o de tom">
      <label for="tons">Tom:</label>
      <div id="tons" tabindex="0" aria-live="polite" aria-relevant="additions"></div>
    </div>

    <div class="modo-toggle" role="group" aria-label="Modos de exibi√ß√£o">
      <button id="toggleModo" aria-pressed="false" type="button">Modo: Maior</button>
      <button id="btnGeral" type="button">Modo Geral</button>
      <button id="btnIndividual" type="button">Modo Individual</button>
      <button id="btnResetIndividual" type="button" style="display:none;">Resetar Individual</button>
      <button id="btnProg" type="button">‚ñ∂ Progress√£o Auto</button>
      <button id="btnQuiz" type="button">‚ùì Modo Treino</button>
    </div>
  </section>

  <section class="graus" aria-label="Graus do campo harm√¥nico" role="list">
    <div role="listitem">I</div><div role="listitem">II</div><div role="listitem">III</div>
    <div role="listitem">IV</div><div role="listitem">V</div><div role="listitem">VI</div><div role="listitem">VII¬∞</div>
  </section>

  <section id="acordes" class="acordes" aria-live="polite" aria-label="Acordes do campo harm√¥nico"></section>
  <section id="meta" class="meta" aria-live="polite" aria-atomic="true"></section>

  <section id="teoria-container" aria-label="Se√ß√£o de teoria musical">
    <button id="btnToggleTeoria" aria-expanded="false" aria-controls="teoria" type="button">üìò Ver Teoria</button>

    <div id="teoria" class="teoria" style="display: none;">
      <nav class="tabs" role="tablist" aria-label="Abas de teoria">
        <button id="tab-geral" role="tab" aria-selected="true" tabindex="0" type="button">üéµ Geral</button>
        <button id="tab-progressao" role="tab" aria-selected="false" tabindex="-1" type="button">üéº Progress√µes</button>
        <button id="tab-dicionario" role="tab" aria-selected="false" tabindex="-1" type="button">üìñ Dicion√°rio</button>
        <button id="tab-intervalos" role="tab" aria-selected="false" tabindex="-1" type="button">üé∂ Intervalos</button>
        <button id="tab-apoio" role="tab" aria-selected="false" tabindex="-1" type="button">‚ù§Ô∏è Apoie</button>
      </nav>

      <article id="aba-geral" class="aba" role="tabpanel" tabindex="0">
        <h2>Teoria Geral</h2>
        <p>O <strong>campo harm√¥nico</strong> √© o conjunto de acordes formados a partir das notas de uma escala.</p>
        <p><strong>Aplica√ß√£o pr√°tica:</strong> ajuda a entender quais acordes combinam dentro de um tom e a criar progress√µes harm√¥nicas.</p>
        <h3>Campo Maior:</h3>
        <ul>
          <li><strong>I</strong> ‚Äî maior (t√¥nica)</li>
          <li><strong>ii</strong> ‚Äî menor (subdominante)</li>
          <li><strong>iii</strong> ‚Äî menor (menor mediano)</li>
          <li><strong>IV</strong> ‚Äî maior (subdominante)</li>
          <li><strong>V</strong> ‚Äî maior (dominante)</li>
          <li><strong>vi</strong> ‚Äî menor (relativo menor)</li>
          <li><strong>vii¬∞</strong> ‚Äî diminuto (tens√£o que resolve)</li>
        </ul>
        <h3>Campo Menor:</h3>
        <ul>
          <li><strong>i</strong> ‚Äî menor (t√¥nica)</li>
          <li><strong>ii¬∞</strong> ‚Äî diminuto (tens√£o)</li>
          <li><strong>III</strong> ‚Äî maior (mediant)</li>
          <li><strong>iv</strong> ‚Äî menor (subdominante)</li>
          <li><strong>v</strong> ‚Äî menor (dominante)</li>
          <li><strong>VI</strong> ‚Äî maior (submediante)</li>
          <li><strong>VII</strong> ‚Äî maior (sens√≠vel)</li>
        </ul>
        <p>Dica: pratique reconhecendo esses graus no seu instrumento para internalizar o som e a fun√ß√£o de cada acorde.</p>
      </article>

      <article id="aba-progressao" class="aba" role="tabpanel" tabindex="0" style="display: none;">
        <h2>Exemplos de Progress√£o</h2>
        <p><strong>1. Pop Cl√°ssico:</strong> I - V - vi - IV<br><em>Ex: C - G - Am - F</em></p>
        <p><strong>2. Rock Simples:</strong> I - IV - V<br><em>Ex: C - F - G</em></p>
        <p><strong>3. Jazz / MPB:</strong> ii - V - I<br><em>Ex: Dm - G - C</em></p>
        <p><strong>4. Emo√ß√£o crescente:</strong> vi - IV - I - V<br><em>Ex: Am - F - C - G</em></p>
        <p>Experimente essas combina√ß√µes nos tons que quiser!</p>
      </article>

      <article id="aba-dicionario" class="aba" role="tabpanel" tabindex="0" style="display: none;">
        <h2>Dicion√°rio de Graus</h2>
        <ul>
          <li><strong>I</strong>: T√¥nica (estabilidade total)</li>
          <li><strong>ii</strong>: Subdominante menor (prepara)</li>
          <li><strong>iii</strong>: Menor mediano (transi√ß√µes)</li>
          <li><strong>IV</strong>: Subdominante maior (abre)</li>
          <li><strong>V</strong>: Dominante (tens√£o, resolve pro I)</li>
          <li><strong>vi</strong>: Relativo menor do I</li>
          <li><strong>vii¬∞</strong>: Diminuto, inst√°vel (pede resolu√ß√£o)</li>
        </ul>
      </article>

      <article id="aba-intervalos" class="aba" role="tabpanel" tabindex="0" style="display:none;">
        <h2>Intervalos Musicais</h2>
        <p>Intervalos s√£o a dist√¢ncia entre duas notas. Eles formam a base para a constru√ß√£o de escalas e acordes.</p>
        <ul>
          <li><strong>Un√≠ssono</strong>: mesma nota (0 semitons)</li>
          <li><strong>Segunda menor</strong>: 1 semitom</li>
          <li><strong>Segunda maior</strong>: 2 semitons</li>
          <li><strong>Ter√ßa menor</strong>: 3 semitons</li>
          <li><strong>Ter√ßa maior</strong>: 4 semitons</li>
          <li><strong>Quarta justa</strong>: 5 semitons</li>
          <li><strong>Quinta justa</strong>: 7 semitons</li>
          <li><strong>Sexta maior</strong>: 9 semitons</li>
          <li><strong>S√©tima maior</strong>: 11 semitons</li>
          <li><strong>Oitava</strong>: 12 semitons (uma oitava acima)</li>
        </ul>
        <p>Entender intervalos √© fundamental para montar acordes e progress√µes harm√¥nicas.</p>
      </article>

      <article id="aba-apoio" class="aba" role="tabpanel" tabindex="0" style="display: none;">
        <h2>‚ù§Ô∏è Apoie este Projeto</h2>
        <p>Se o <strong>SemitONada</strong> te ajuda, considere apoiar com qualquer valor via Pix.</p>
        <p>Por enquanto, o Pix est√° no meu nome pessoal, mas toda ajuda vai direto para manter e melhorar o app!</p>
        <p>Obrigado pelo seu apoio e por compartilhar com outros m√∫sicos! üé∂</p>
        <button id="btnPix" data-pix="biel.simeone@gmail.com" type="button">üîó Copiar chave Pix</button>
        <p id="confirmacaoPix" style="color:#0f0; margin-top:0.5rem; display:none;">Chave Pix copiada para a √°rea de transfer√™ncia!</p>
      </article>
    </div>
  </section>
</main>

<script>
  // Dados principais
  const notas = ['C', 'C# / Db', 'D', 'Eb / D#', 'E', 'F', 'F# / Gb', 'G', 'G# / Ab', 'A', 'Bb / A#', 'B'];

  const campos = {
    maior: {
      intervalos: [0, 2, 4, 5, 7, 9, 11],
      sufixos: ["", "m", "m", "", "", "m", "¬∞"]
    },
    menor: {
      intervalos: [0, 2, 3, 5, 7, 8, 10],
      sufixos: ["m", "¬∞", "", "m", "m", "", ""]
    }
  };

  let modoAtual = 'maior';
  let tomAtual = 'C';
  let acordeAtual = 0;
  let modoProg = false;
  let modoQuiz = false;
  let progIntervalId = null;

  // Elementos DOM
  const tonsDiv = document.getElementById("tons");
  const acordesDiv = document.getElementById("acordes");
  const metaDiv = document.getElementById("meta");
  const toggleBtn = document.getElementById("toggleModo");
  const btnGeral = document.getElementById("btnGeral");
  const btnIndividual = document.getElementById("btnIndividual");
  const btnResetIndividual = document.getElementById("btnResetIndividual");
  const btnToggleTeoria = document.getElementById("btnToggleTeoria");
  const teoriaDiv = document.getElementById("teoria");
  const tabs = document.querySelectorAll('.tabs button');
  const btnPix = document.getElementById("btnPix");
  const btnProg = document.getElementById("btnProg");
  const btnQuiz = document.getElementById("btnQuiz");

  // Atualiza texto do modo
  function setModoTexto() {
    toggleBtn.textContent = `Modo: ${modoAtual === 'maior' ? 'Maior' : 'Menor'}`;
    toggleBtn.setAttribute('aria-pressed', modoAtual === 'menor');
  }

  // Ativa bot√£o do tom selecionado
  function ativarBotaoTom(nota) {
    document.querySelectorAll('#tons button').forEach(b => b.classList.remove('ativo'));
    const btn = [...tonsDiv.children].find(b => b.textContent === nota);
    if (btn) btn.classList.add('ativo');
  }

  // Limpa acordes e meta
  function limpar() {
    acordesDiv.innerHTML = '';
    metaDiv.textContent = '';
    btnResetIndividual.style.display = 'none';
    pararProgressao();
    modoProg = false;
    btnProg.textContent = '‚ñ∂ Progress√£o Auto';
  }

  // Gera campo harm√¥nico com dupla nomenclatura
  function gerarCampo(tom, modo) {
    const idx = notas.findIndex(n => n.startsWith(tom));
    const { intervalos, sufixos } = campos[modo];
    return intervalos.map((intv, i) => {
      // Retorna a nota (dupla nome) + sufixo
      const notaCompleta = notas[(idx + intv) % 12];
      return notaCompleta + sufixos[i];
    });
  }

  // Mostra todos os acordes do campo
  function mostrarTodos() {
    const campo = gerarCampo(tomAtual, modoAtual);
    acordesDiv.innerHTML = '';
    campo.forEach(ac => {
      const div = document.createElement("div");
      div.textContent = ac;
      acordesDiv.appendChild(div);
    });
    metaDiv.textContent = `Campo harm√¥nico de ${tomAtual} (${modoAtual})`;
    btnResetIndividual.style.display = 'none';
  }

  // Modo individual com abertura dos acordes clicando
  function modoIndividual() {
    const campo = gerarCampo(tomAtual, modoAtual);
    acordesDiv.innerHTML = '';
    for (let i = 0; i < 7; i++) {
      const div = document.createElement("div");
      div.textContent = i === 0 ? campo[0] : "‚óè";
      if (i !== 0) div.setAttribute("data-fechado", "true");
      div.tabIndex = 0;
      div.setAttribute('role', 'button');
      div.setAttribute('aria-pressed', div.textContent !== "‚óè");
      div.onclick = () => {
        if (div.textContent === "‚óè") {
          div.textContent = campo[i];
          div.removeAttribute("data-fechado");
          div.setAttribute('aria-pressed', "true");
          atualizarMeta();
        }
      };
      acordesDiv.appendChild(div);
    }
    acordeAtual = 1;
    atualizarMeta();
    btnResetIndividual.style.display = 'inline-block';
  }

  // Reseta modo individual
  function resetarIndividual() {
    modoIndividual();
  }

  // Atualiza progresso na meta
  function atualizarMeta() {
    const mostrados = [...acordesDiv.children].filter(d => d.textContent !== "‚óè").length;
    metaDiv.textContent = `Progresso: ${mostrados}/7`;
  }

  // Alterna entre modo maior e menor
  function alternarModo() {
    modoAtual = modoAtual === 'maior' ? 'menor' : 'maior';
    setModoTexto();
    limpar();
  }

  // Toggle teoria vis√≠vel/invis√≠vel
  function toggleTeoria() {
    const isHidden = teoriaDiv.style.display === "none" || teoriaDiv.style.display === "";
    teoriaDiv.style.display = isHidden ? "block" : "none";
    btnToggleTeoria.setAttribute('aria-expanded', isHidden);
  }

  // Mostrar aba da teoria
  function mostrarAba(nome) {
    const abas = document.querySelectorAll('.aba');
    abas.forEach(aba => aba.style.display = 'none');
    document.getElementById(`aba-${nome}`).style.display = 'block';

    tabs.forEach(btn => {
      btn.classList.remove('ativo');
      btn.setAttribute('aria-selected', 'false');
      btn.tabIndex = -1;
    });
    const btn = document.getElementById(`tab-${nome}`);
    btn.classList.add('ativo');
    btn.setAttribute('aria-selected', 'true');
    btn.tabIndex = 0;
    btn.focus();
  }

  // Copiar chave Pix para clipboard com feedback
  function copiarPix() {
    const chave = btnPix.getAttribute("data-pix");
    navigator.clipboard.writeText(chave).then(() => {
      const c = document.getElementById("confirmacaoPix");
      c.style.display = 'block';
      setTimeout(() => {
        c.style.display = 'none';
      }, 3000);
    });
  }

  // Fun√ß√£o progress√£o autom√°tica com anima√ß√£o
  function iniciarProgressao() {
    if (modoProg) {
      pararProgressao();
      return;
    }
    modoProg = true;
    btnProg.textContent = '‚ñ† Parar Progress√£o';
    const campo = gerarCampo(tomAtual, modoAtual);
    acordesDiv.innerHTML = '';
    let idx = 0;

    progIntervalId = setInterval(() => {
      acordesDiv.innerHTML = '';
      for (let i = 0; i < 7; i++) {
        const div = document.createElement("div");
        if (i === idx) {
          div.textContent = campo[i];
          div.style.backgroundColor = 'var(--cor-primaria)';
          div.style.color = 'var(--cor-fundo)';
        } else {
          div.textContent = "‚óè";
          div.setAttribute("data-fechado", "true");
          div.style.backgroundColor = '';
          div.style.color = '';
        }
        acordesDiv.appendChild(div);
      }
      metaDiv.textContent = `Acorde em destaque: ${campo[idx]}`;
      idx = (idx + 1) % 7;
    }, 1500);
  }

  function pararProgressao() {
    if (progIntervalId) {
      clearInterval(progIntervalId);
      progIntervalId = null;
      modoProg = false;
      btnProg.textContent = '‚ñ∂ Progress√£o Auto';
      mostrarTodos();
      metaDiv.textContent = 'Progress√£o autom√°tica parada.';
    }
  }

  // Modo quiz treino: pergunta e checa respostas
  function iniciarQuiz() {
    if (modoQuiz) {
      pararQuiz();
      return;
    }
    modoQuiz = true;
    btnQuiz.textContent = '‚ñ† Parar Treino';

    const campo = gerarCampo(tomAtual, modoAtual);
    let perguntaIndex = 0;
    metaDiv.textContent = 'Modo treino ativado: identifique os acordes!';

    acordesDiv.innerHTML = '';
    // Come√ßa com todos ocultos
    campo.forEach(() => {
      const div = document.createElement("div");
      div.textContent = "‚óè";
      div.setAttribute("data-fechado", "true");
      div.style.cursor = "default";
      acordesDiv.appendChild(div);
    });

    function perguntar() {
      if (!modoQuiz) return;
      const divs = acordesDiv.children;
      // Pergunta um acorde aleat√≥rio fechado
      let candidatos = [];
      for (let i = 0; i < divs.length; i++) {
        if (divs[i].textContent === "‚óè") candidatos.push(i);
      }
      if (candidatos.length === 0) {
        metaDiv.textContent = 'Parab√©ns! Voc√™ identificou todos os acordes!';
        pararQuiz();
        return;
      }
      perguntaIndex = candidatos[Math.floor(Math.random() * candidatos.length)];

      metaDiv.textContent = `Qual √© o acorde na posi√ß√£o ${perguntaIndex + 1} (grau ${['I','II','III','IV','V','VI','VII¬∞'][perguntaIndex]})?`;

      // Criar input para resposta
      acordesDiv.innerHTML = '';
      for (let i = 0; i < 7; i++) {
        const div = document.createElement("div");
        if (i === perguntaIndex) {
          const input = document.createElement("input");
          input.type = "text";
          input.setAttribute("aria-label", `Resposta para acorde do grau ${['I','II','III','IV','V','VI','VII¬∞'][i]}`);
          input.autocomplete = "off";
          input.spellcheck = false;
          input.style.width = "70px";
          div.appendChild(input);

          input.focus();

          input.onkeydown = (e) => {
            if (e.key === "Enter") {
              const resposta = input.value.trim().toLowerCase();
              const correta = campo[i].toLowerCase();
              // Aceita resposta parcial: s√≥ nota base e sufixo sem espa√ßo, ignora dupla nomenclatura
              // Exemplo: "C" ou "Cm" ou "c#m" etc
              const corretaSimplificada = correta.split(' ')[0]; // Pega s√≥ a primeira parte (antes do espa√ßo)
              if (resposta === corretaSimplificada || resposta === corretaSimplificada.replace('#', '‚ôØ').replace('b', '‚ô≠')) {
                div.textContent = campo[i];
                div.style.backgroundColor = 'var(--cor-alerta)';
                metaDiv.textContent = 'Resposta correta! üéâ';
                setTimeout(() => {
                  perguntar();
                }, 1500);
              } else {
                metaDiv.textContent = 'Resposta errada, tente de novo.';
                input.select();
              }
            }
          };
        } else {
          div.textContent = "‚óè";
          div.setAttribute("data-fechado", "true");
        }
        acordesDiv.appendChild(div);
      }
    }
    perguntar();
  }

  function pararQuiz() {
    modoQuiz = false;
    btnQuiz.textContent = '‚ùì Modo Treino';
    mostrarTodos();
    metaDiv.textContent = 'Modo treino parado.';
  }

  // Eventos e inicializa√ß√£o
  document.addEventListener('DOMContentLoaded', () => {
    // Criar bot√µes dos tons com dupla nomenclatura simplificada (primeira parte)
    notas.forEach(nota => {
      const btn = document.createElement("button");
      // Mostrar s√≥ a primeira nota antes do espa√ßo para o bot√£o ficar clean
      btn.textContent = nota.split(' ')[0];
      btn.type = 'button';
      btn.addEventListener('click', () => {
        tomAtual = btn.textContent;
        acordeAtual = 0;
        ativarBotaoTom(btn.textContent);
        limpar();
      });
      tonsDiv.appendChild(btn);
    });

    ativarBotaoTom(tomAtual);
    setModoTexto();
    mostrarTodos();

    toggleBtn.addEventListener('click', () => {
      alternarModo();
      mostrarTodos();
    });

    btnGeral.addEventListener('click', mostrarTodos);
    btnIndividual.addEventListener('click', modoIndividual);
    btnResetIndividual.addEventListener('click', resetarIndividual);
    btnToggleTeoria.addEventListener('click', toggleTeoria);
    tabs.forEach(tab => tab.addEventListener('click', () => mostrarAba(tab.id.replace('tab-', ''))));
    btnPix.addEventListener('click', copiarPix);
    btnProg.addEventListener('click', iniciarProgressao);
    btnQuiz.addEventListener('click', () => {
      if (modoProg) pararProgressao();
      iniciarQuiz();
    });
  });
</script>
</body>
</html>

