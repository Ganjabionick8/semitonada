<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SemitONada</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Insira aqui o CSS que eu te mandei antes, ou mantenha no arquivo externo */
  </style>
</head>
<body>
  <main class="container">
    <h1>SemitONada</h1>

    <section class="controles" aria-label="Controles do Campo Harm√¥nico">
      <div class="tom-btns" role="group" aria-label="Sele√ß√£o de tom">
        <label for="tons">Tom:</label>
        <div id="tons" tabindex="0" aria-live="polite" aria-relevant="additions"></div>
      </div>

      <div class="modo-toggle" role="group" aria-label="Modos de exibi√ß√£o">
        <button id="toggleModo" aria-pressed="false" type="button">Modo: Maior</button>
        <button id="btnGeral" type="button">Modo Geral</button>
        <button id="btnIndividual" type="button">Modo Individual</button>
        <button id="btnResetIndividual" type="button" style="display:none;">Resetar Individual</button>
        <button id="btnAutoProg" type="button">‚ñ∂Ô∏è Auto Progress√£o</button>
        <button id="btnTreino" type="button">üß† Modo Treino</button>
      </div>

      <div class="nome-dupla" role="group" aria-label="Nomenclatura">
        <label for="toggleNomenclatura">Nomenclatura:</label>
        <button id="toggleNomenclatura" type="button" aria-pressed="false">Mostrar Bem√≥is</button>
      </div>
    </section>

    <section class="graus" aria-label="Graus do campo harm√¥nico" role="list">
      <div role="listitem">I</div><div role="listitem">II</div><div role="listitem">III</div>
      <div role="listitem">IV</div><div role="listitem">V</div><div role="listitem">VI</div><div role="listitem">VII¬∞</div>
    </section>

    <section id="acordes" class="acordes" aria-live="polite" aria-label="Acordes do campo harm√¥nico"></section>
    <section id="meta" class="meta" aria-live="polite" aria-atomic="true"></section>

    <section id="teoria-container" aria-label="Se√ß√£o de teoria musical">
      <button id="btnToggleTeoria" aria-expanded="false" aria-controls="teoria" type="button">üìò Ver Teoria</button>

      <div id="teoria" class="teoria" style="display: none;">
        <nav class="tabs" role="tablist" aria-label="Abas de teoria">
          <button id="tab-geral" role="tab" aria-selected="true" tabindex="0" type="button">üéµ Geral</button>
          <button id="tab-progressao" role="tab" aria-selected="false" tabindex="-1" type="button">üéº Progress√µes</button>
          <button id="tab-dicionario" role="tab" aria-selected="false" tabindex="-1" type="button">üìñ Dicion√°rio</button>
          <button id="tab-intervalos" role="tab" aria-selected="false" tabindex="-1" type="button">üé∂ Intervalos</button>
          <button id="tab-apoio" role="tab" aria-selected="false" tabindex="-1" type="button">‚ù§Ô∏è Apoie</button>
        </nav>

        <article id="aba-geral" class="aba" role="tabpanel" tabindex="0">
          <h2>Teoria Geral</h2>
          <p>O <strong>campo harm√¥nico</strong> √© o conjunto de acordes formados a partir das notas de uma escala.</p>
          <p><strong>Aplica√ß√£o pr√°tica:</strong> ajuda a entender quais acordes combinam dentro de um tom e a criar progress√µes harm√¥nicas.</p>
          <h3>Campo Maior:</h3>
          <ul>
            <li><strong>I</strong> ‚Äî maior (t√¥nica)</li>
            <li><strong>ii</strong> ‚Äî menor (subdominante)</li>
            <li><strong>iii</strong> ‚Äî menor (menor mediano)</li>
            <li><strong>IV</strong> ‚Äî maior (subdominante)</li>
            <li><strong>V</strong> ‚Äî maior (dominante)</li>
            <li><strong>vi</strong> ‚Äî menor (relativo menor)</li>
            <li><strong>vii¬∞</strong> ‚Äî diminuto (tens√£o que resolve)</li>
          </ul>
          <h3>Campo Menor:</h3>
          <ul>
            <li><strong>i</strong> ‚Äî menor (t√¥nica)</li>
            <li><strong>ii¬∞</strong> ‚Äî diminuto (tens√£o)</li>
            <li><strong>III</strong> ‚Äî maior (mediant)</li>
            <li><strong>iv</strong> ‚Äî menor (subdominante)</li>
            <li><strong>v</strong> ‚Äî menor (dominante)</li>
            <li><strong>VI</strong> ‚Äî maior (submediante)</li>
            <li><strong>VII</strong> ‚Äî maior (sens√≠vel)</li>
          </ul>
          <p>Dica: pratique reconhecendo esses graus no seu instrumento para internalizar o som e a fun√ß√£o de cada acorde.</p>
        </article>

        <article id="aba-progressao" class="aba" role="tabpanel" tabindex="0" style="display: none;">
          <h2>Exemplos de Progress√£o</h2>
          <p><strong>1. Pop Cl√°ssico:</strong> I - V - vi - IV<br><em>Ex: C - G - Am - F</em></p>
          <p><strong>2. Rock Simples:</strong> I - IV - V<br><em>Ex: C - F - G</em></p>
          <p><strong>3. Jazz / MPB:</strong> ii - V - I<br><em>Ex: Dm - G - C</em></p>
          <p><strong>4. Emo√ß√£o crescente:</strong> vi - IV - I - V<br><em>Ex: Am - F - C - G</em></p>
          <p>Experimente essas combina√ß√µes nos tons que quiser!</p>
        </article>

        <article id="aba-dicionario" class="aba" role="tabpanel" tabindex="0" style="display: none;">
          <h2>Dicion√°rio de Graus</h2>
          <ul>
            <li><strong>I</strong>: T√¥nica (estabilidade total)</li>
            <li><strong>ii</strong>: Subdominante menor (prepara)</li>
            <li><strong>iii</strong>: Menor mediano (transi√ß√µes)</li>
            <li><strong>IV</strong>: Subdominante maior (abre)</li>
            <li><strong>V</strong>: Dominante (tens√£o, resolve pro I)</li>
            <li><strong>vi</strong>: Relativo menor do I</li>
            <li><strong>vii¬∞</strong>: Diminuto, inst√°vel (pede resolu√ß√£o)</li>
          </ul>
        </article>

        <article id="aba-intervalos" class="aba" role="tabpanel" tabindex="0" style="display:none;">
          <h2>Intervalos Musicais</h2>
          <p>Intervalos s√£o a dist√¢ncia entre duas notas. Eles formam a base para a constru√ß√£o de escalas e acordes.</p>
          <ul>
            <li><strong>Un√≠ssono</strong>: mesma nota (0 semitons)</li>
            <li><strong>Segunda menor</strong>: 1 semitom</li>
            <li><strong>Segunda maior</strong>: 2 semitons</li>
            <li><strong>Ter√ßa menor</strong>: 3 semitons</li>
            <li><strong>Ter√ßa maior</strong>: 4 semitons</li>
            <li><strong>Quarta justa</strong>: 5 semitons</li>
            <li><strong>Quinta justa</strong>: 7 semitons</li>
            <li><strong>Sexta maior</strong>: 9 semitons</li>
            <li><strong>S√©tima maior</strong>: 11 semitons</li>
            <li><strong>Oitava</strong>: 12 semitons (uma oitava acima)</li>
          </ul>
          <p>Entender intervalos √© fundamental para montar acordes e progress√µes harm√¥nicas.</p>
        </article>

        <article id="aba-apoio" class="aba" role="tabpanel" tabindex="0" style="display: none;">
          <h2>‚ù§Ô∏è Apoie este Projeto</h2>
          <p>Se o <strong>SemitONada</strong> te ajuda, considere apoiar com qualquer valor via Pix.</p>
          <p>Por enquanto, o Pix est√° no meu nome pessoal, mas toda ajuda vai direto para manter e melhorar o app!</p>
          <p>Obrigado pelo seu apoio e por compartilhar com outros m√∫sicos! üé∂</p>
          <button id="btnPix" data-pix="biel.simeone@gmail.com" type="button">üîó Copiar chave Pix</button>
          <p id="confirmacaoPix" style="color:#0f0; margin-top:0.5rem; display:none;">Chave Pix copiada para a √°rea de transfer√™ncia!</p>
        </article>
      </div>
    </section>
  </main>

<script>
const notasSharp = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
const notasFlat  = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];

const campos = {
  maior: {
    intervalos: [0, 2, 4, 5, 7, 9, 11],
    sufixos: ["", "m", "m", "", "", "m", "¬∞"]
  },
  menor: {
    intervalos: [0, 2, 3, 5, 7, 8, 10],
    sufixos: ["m", "¬∞", "", "m", "m", "", ""]
  }
};

let modoAtual = 'maior';
let tomAtual = 'C';
let acordeAtual = 0;
let mostrarBemol = false;
let autoProgInterval = null;
let modoTreino = false;

const tonsDiv = document.getElementById("tons");
const acordesDiv = document.getElementById("acordes");
const metaDiv = document.getElementById("meta");
const toggleBtn = document.getElementById("toggleModo");
const btnGeral = document.getElementById("btnGeral");
const btnIndividual = document.getElementById("btnIndividual");
const btnResetIndividual = document.getElementById("btnResetIndividual");
const btnToggleTeoria = document.getElementById("btnToggleTeoria");
const teoriaDiv = document.getElementById("teoria");
const tabs = document.querySelectorAll('.tabs button');
const btnPix = document.getElementById("btnPix");
const btnAutoProg = document.getElementById("btnAutoProg");
const btnTreino = document.getElementById("btnTreino");
const toggleNomenclatura = document.getElementById("toggleNomenclatura");

function setModoTexto() {
  toggleBtn.textContent = `Modo: ${modoAtual === 'maior' ? 'Maior' : 'Menor'}`;
  toggleBtn.setAttribute('aria-pressed', modoAtual === 'menor');
}

function ativarBotaoTom(nota) {
  document.querySelectorAll('#tons button').forEach(b => b.classList.remove('ativo'));
  const btn = [...tonsDiv.children].find(b => b.textContent === nota || b.textContent === converterNota(nota));
  if (btn) btn.classList.add('ativo');
}

function limpar() {
  acordesDiv.innerHTML = '';
  metaDiv.textContent = '';
  btnResetIndividual.style.display = 'none';
  pararAutoProg();
  modoTreino = false;
  btnTreino.textContent = "üß† Modo Treino";
}

function converterNota(nota) {
  if (!mostrarBemol) return nota;
  const i = notasSharp.indexOf(nota);
  return i >= 0 ? notasFlat[i] : nota;
}

function gerarCampo(tom, modo) {
  const baseNotas = mostrarBemol ? notasFlat : notasSharp;
  const idx = baseNotas.indexOf(tom);
  const { intervalos, sufixos } = campos[modo];
  return intervalos.map((intv, i) => {
    const nota = baseNotas[(idx + intv) % 12];
    return nota + sufixos[i];
  });
}

function mostrarTodos() {
  modoTreino = false;
  limpar();
  const campo = gerarCampo(tomAtual, modoAtual);
  acordesDiv.innerHTML = '';
  campo.forEach(ac => {
    const div = document.createElement("div");
    div.textContent = ac;
    acordesDiv.appendChild(div);
  });
  metaDiv.textContent = `Campo harm√¥nico de ${converterNota(tomAtual)} (${modoAtual})`;
}

function modoIndividual() {
  modoTreino = false;
  limpar();
  const campo = gerarCampo(tomAtual, modoAtual);
  acordesDiv.innerHTML = '';
  for (let i = 0; i < 7; i++) {
    const div = document.createElement("div");
    div.textContent = i === 0 ? campo[0] : "‚óè";
    if (i !== 0) div.setAttribute("data-fechado", "true");
    div.tabIndex = 0;
    div.setAttribute('role', 'button');
    div.setAttribute('aria-pressed', div.textContent !== "‚óè");
    div.onclick = () => {
      if (div.textContent === "‚óè") {
        div.textContent = campo[i];
        div.removeAttribute("data-fechado");
        div.setAttribute('aria-pressed', "true");
        atualizarMeta();
      }
    };
    acordesDiv.appendChild(div);
  }
  acordeAtual = 1;
  atualizarMeta();
  btnResetIndividual.style.display = 'inline-block';
}

function resetarIndividual() {
  modoIndividual();
}

function atualizarMeta() {
  const mostrados = [...acordesDiv.children].filter(d => d.textContent !== "‚óè").length;
  metaDiv.textContent = modoTreino
    ? `Modo Treino: ${mostrados}/7 acertados`
    : `Progresso: ${mostrados}/7`;
}

function alternarModo() {
  modoAtual = modoAtual === 'maior' ? 'menor' : 'maior';
  setModoTexto();
  limpar();
}

function toggleTeoria() {
  const isHidden = teoriaDiv.style.display === "none" || teoriaDiv.style.display === "";
  teoriaDiv.style.display = isHidden ? "block" : "none";
  btnToggleTeoria.setAttribute('aria-expanded', isHidden);
}

function mostrarAba(nome) {
  const abas = document.querySelectorAll('.aba');
  abas.forEach(aba => aba.style.display = 'none');
  document.getElementById(`aba-${nome}`).style.display = 'block';

  tabs.forEach(btn => {
    btn.classList.remove('ativo');
    btn.setAttribute('aria-selected', 'false');
    btn.tabIndex = -1;
  });
  const btn = document.getElementById(`tab-${nome}`);
  btn.classList.add('ativo');
  btn.setAttribute('aria-selected', 'true');
  btn.tabIndex = 0;
  btn.focus();
}

function copiarPix() {
  const chave = btnPix.getAttribute("data-pix");
  navigator.clipboard.writeText(chave).then(() => {
    const c = document.getElementById("confirmacaoPix");
    c.style.display = 'block';
    setTimeout(() => {
      c.style.display = 'none';
    }, 3000);
  });
}

// === Auto Progress√£o ===

function autoProgressao() {
  if (autoProgInterval) return; // j√° rodando
  limpar();
  const campo = gerarCampo(tomAtual, modoAtual);
  let idx = 0;
  acordesDiv.innerHTML = '';
  for(let i=0; i<7; i++) {
    const div = document.createElement("div");
    div.textContent = "‚óè";
    div.setAttribute("data-fechado", "true");
    div.tabIndex = 0;
    acordesDiv.appendChild(div);
  }
  metaDiv.textContent = `Progress√£o autom√°tica de ${converterNota(tomAtual)} (${modoAtual})`;
  autoProgInterval = setInterval(() => {
    if(idx >= 7) {
      pararAutoProg();
      return;
    }
    const div = acordesDiv.children[idx];
    div.textContent = campo[idx];
    div.removeAttribute("data-fechado");
    idx++;
  }, 1200);
}

function pararAutoProg() {
  if(autoProgInterval) {
    clearInterval(autoProgInterval);
    autoProgInterval = null;
  }
}

// === Modo Treino ===

function iniciarTreino() {
  modoTreino = true;
  limpar();
  btnTreino.textContent = "‚ùå Sair do Treino";
  metaDiv.textContent = `Modo Treino: clique no acorde correto`;
  const campo = gerarCampo(tomAtual, modoAtual);
  const graus = ["I","II","III","IV","V","VI","VII"];
  
  acordesDiv.innerHTML = '';
  
  // Escolhe grau alvo aleat√≥rio
  let alvo = Math.floor(Math.random()*7);
  
  // Fun√ß√£o para criar bot√µes e checar respostas
  function criarBotao(i) {
    const div = document.createElement("div");
    div.textContent = campo[i];
    div.tabIndex = 0;
    div.setAttribute('role','button');
    div.style.cursor = 'pointer';
    div.onclick = () => {
      if(!modoTreino) return;
      if(i === alvo) {
        metaDiv.textContent = `Acertou! Grau ${graus[alvo]}: ${campo[alvo]}`;
        iniciarTreino(); // reinicia com novo alvo
      } else {
        metaDiv.textContent = `Errado! Tente novamente.`;
      }
    };
    return div;
  }

  for(let i=0; i<7; i++) {
    acordesDiv.appendChild(criarBotao(i));
  }

  // Mostra desafio
  metaDiv.textContent = `Modo Treino: clique no acorde do grau ${graus[alvo]}`;
}

// === Eventos ===

document.addEventListener('DOMContentLoaded', () => {
  // Popula tons com dupla nomenclatura
  notasSharp.forEach((nota, i) => {
    const nomeExibir = mostrarBemol ? notasFlat[i] : nota;
    const btn = document.createElement("button");
    btn.textContent = nomeExibir;
    btn.type = 'button';
    btn.addEventListener('click', () => {
      tomAtual = nota; // mantemos sempre a nota sharp interna para gerar acordes
      acordeAtual = 0;
      ativarBotaoTom(nomeExibir);
      limpar();
    });
    tonsDiv.appendChild(btn);
  });

  ativarBotaoTom(converterNota(tomAtual));
  setModoTexto();
  mostrarAba('geral');

  toggleBtn.addEventListener('click', () => {
    alternarModo();
    mostrarTodos();
  });
  btnGeral.addEventListener('click', mostrarTodos);
  btnIndividual.addEventListener('click', modoIndividual);
  btnResetIndividual.addEventListener('click', resetarIndividual);
  btnToggleTeoria.addEventListener('click', toggleTeoria);
  tabs.forEach(tab => tab.addEventListener('click', () => mostrarAba(tab.id.replace('tab-', ''))));
  btnPix.addEventListener('click', copiarPix);

  btnAutoProg.addEventListener('click', () => {
    if(autoProgInterval) {
      pararAutoProg();
      mostrarTodos();
    } else {
      autoProgressao();
    }
  });

  btnTreino.addEventListener('click', () => {
    if(modoTreino) {
      modoTreino = false;
      btnTreino.textContent = "üß† Modo Treino";
      mostrarTodos();
    } else {
      iniciarTreino();
    }
  });

  toggleNomenclatura.addEventListener('click', () => {
    mostrarBemol = !mostrarBemol;
    toggleNomenclatura.setAttribute('aria-pressed', mostrarBemol);
    toggleNomenclatura.textContent = mostrarBemol ? "Mostrar Sustenidos" : "Mostrar Bem√≥is";
    // Atualiza os bot√µes dos tons
    tonsDiv.innerHTML = '';
    notasSharp.forEach((nota, i) => {
      const nomeExibir = mostrarBemol ? notasFlat[i] : nota;
      const btn = document.createElement("button");
      btn.textContent = nomeExibir;
      btn.type = 'button';
      btn.addEventListener('click', () => {
        tomAtual = nota;
        acordeAtual = 0;
        ativarBotaoTom(nomeExibir);
        limpar();
      });
      tonsDiv.appendChild(btn);
    });
    ativarBotaoTom(converterNota(tomAtual));
    mostrarTodos();
  });

  mostrarTodos();
});
</script>
</body>
</html>
